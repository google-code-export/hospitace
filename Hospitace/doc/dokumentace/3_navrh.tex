\chapter{Návrh}

\section{Technologie a služby}
Tato část popisuje jednotlivé technologie a služby potřebné pro implementaci aplikace.

\subsection{Ruby on Rails}
Ruby on Rails \cite{rubyonrails}, zkráceně Rails, je jedno z implementačních omezení, které se nachází v zadání práce. Jedná se o moderní framework určený pro vývoj webových aplikací napojených na relační databázi. Framework je napsán ve skriptovacím interpretovaným programovacím jazyku Ruby \cite{ruby}. Rails používá návrhový vzor Model-view-controller viz \ref{mvc}. Mezi základní myšlenky a filozofií frameworku patří dva principy. Prvním principem je Convention over Configuration viz \ref{coc} a druhým je Don’t Repeat Yourself viz \ref{dry}.

\subsubsection{Balíčkovací systém RubyGems}
Protože jsou Rails postaveny na jazyku Ruby lze používat balíčkovací systém RubyGems, kde je velké množství již existujících řešení, které jsou dostupné jako knihovny\footnote{v RubyGems se knihovna nazývá Gem}. 

\subsection{KOSapi}
\label{kosapi}
KOSapi je školní webová služba poskytující aplikační rozhraní v podobě RESTful webové služby \ref{rest}. Je určená pro vznik školních aplikací, které potřebují mít přístup k datům souvisejících s výukou. Při vývoji aplikace používám stabilní verzi 2 API. 

Z této služby aplikace čerpá hlavně data předmětů a osob v KOSu. Pro připojení ke KOSapi používám již existující knihovnu napsanou v Ruby ze školního projektu VyVy\cite{vyvy_project}.  

\subsection{FELid}
\label{felid}
FELid \cite{felid} je globální autentizační a autorizační systém pro webovské aplikace na síti FEL. Poskytuje jednotný a bezpečný způsob přihlášení uživatelů a přenos jejich údajů do různých aplikací na webu. Zároveň podporuje jednorázové přihlášení (tzv. single sign-on). Znamená to, že se uživatel přihlašuje pouze do první použité aplikace a u dalších aplikací už nemusí zadávat svoje přihlašovací údaje.

Tuto službu používám pro autentizaci uživatelů do systému. Pro zprovoznění aplikace FELid je nutné splnit technické požadavky, které jsou vystaveny na oficiálních stránkách \cite{felid_pozadavky}.

\subsection{Aplikační server}
\label{apache}
Pro zprovoznění aplikace do reálného provozu jsem použil webový server Apache HTTP server 2.4 \cite{apache}. Tento aplikační server jsem musel zvolit, abych mohl splnit dva obecné požadavky aplikace. Aplikace musí být napsaná v Ruby on Rails a využívat aplikaci FELid pro autentizaci. Tato verze webového serveru totiž dovolí nainstalovat zásuvné moduly Passenger \cite{passenger} a Shibboleth \cite{shibboleth}. Passenger umožňuje nasazení Rails aplikací na aplikačním serveru. Druhý modul Shibboleth zprostředkovává single sign-on autentizaci mezi aplikačním serverem a službou FELid.

\subsection{Databáze}
Ruby on Rails poskytuje možnost připojení k různým databázovým systémům prostřednictvím adaptérů. Díky tomu není aplikace závislá na databázovém systému. Tuto vlastnost používám při vývoji a testování aplikace, kde využívám jednoduchý a snadno konfigurovatelný databázový systém SQLite \cite{sqlite}, který pro tyto účely bohatě postačí. Pro samotné nasazení aplikace do provozu už používám databázový systém MySQL \cite{mysql}.

\section{Architektura}
V této části popisuji použité architektonické vzory a konvence, které dodržuji při implementaci aplikace.

\subsection{MVC}
\label{mvc}
MVC (Model-view-controller) \cite{mvc} je softwarová architektura, která rozděluje datový model aplikace, uživatelské rozhraní a řídicí logiku do tří nezávislých komponent\footnote{models, views a controllers} tak, že modifikace některé z nich má minimální vliv na ostatní. Tento architektonický vzor obsahuje ve svém jádru Ruby on Rails, proto pro implementaci tohoto vzoru vycházím z fungování frameworku.

\subsubsection{Model}
Model reprezentuje informace v aplikaci a pravidla pro práci s nimi. V případě Rails jsou modely primárně využívány pro interakci s příslušnou tabulkou v databázi a pro ukládání pravidel této interakce. Ve většině případů odpovídá jedna tabulka v databázi jednomu modelu aplikace. Modely obsahují většinu aplikační logiky.

\subsubsection{View}
Pohledy, neboli views reprezentují uživatelské rozhraní aplikace. V Rails jsou views obvykle HTML soubory s vloženými částmi Ruby kódu, který provádí pouze úkony týkající se prezentace dat. Views mají na starosti poskytování dat webovému prohlížeči, nebo jinému nástroji, který zasílá vaší aplikaci požadavky.

\subsubsection{Controller}
Kontrolory fungují jako zprostředkovatel mezi modely a views. V Rails slouží kontrolory k zpracování požadavků, které přicházejí z webového prohlížeče, získávání dat z modelů a k odesílání těchto dat do views, kde budou zobrazeny.

\subsection{DRY}
\label{dry}
DRY (Don’t repeat yourself) \cite{dry} je princip vývoje softwaru zaměřený na snížení opakování psaní stejného kódu, čímž se zvyšuje čitelnost a znovupoužitelnost kódu. To znamená, že informace se nacházejí na jednoznačném místě. Pro příklad Ruby on Rails získává definici atributů pro třídu modelu přímo z databáze.  

\subsection{CoC}
\label{coc}
CoC (Convention over Configuration) \cite{coc} je další princip používaný v Rails pro zlepšení čitelnosti a znovupoužitelnosti kódu. Tento princip znamená, že konvence má přednost před konfigurací a to tak, že Rails předpokládá to, co chcete udělat místo toho, aby vás nutil specifikovat každou drobnost v konfiguraci. 

\subsection{REST}
\label{rest}
REST (Representational State Transfer) \cite{rest} je architektonický vzor pro webové aplikace. Je založen na HTTP protokolu a hlavní myšlenkou je poskytovat přístup ke zdrojům dat. Všechny zdroje jsou identifikovány přes URI. REST definuje čtyři základní metody pro přístup ke zdrojům. Jsou známé pod označením CRUD\footnote{create, retriece, update a delete}. Tyto metody jsou implementovány pomocí odpovídajících metod HTTP protokolu. Jednotlivé metody rozeberu na příkladech pro zdroj \textit{observations}\footnote{zdroj aplikace pro práci s hospitacemi}.

\paragraph*{Create}
je požadavek, který pomocí metody POST vytvoří nový záznam. Příklad pro vytvoření nové hospitace.

\begin{quote}
\begin{verbatim}
POST /observations
\end{verbatim} 
\end{quote}

\paragraph*{Retrieve}
je požadavek pro přístup ke zdrojům. Funguje stejným způsobem jako běžný požadavek na stránku pomocí GET metody. První příklad vrátí seznam všech hospitací. Druhý příklad vrátí podrobnosti o konkrétní hospitaci.

\begin{quote}
\begin{verbatim}
GET /observations
GET /observations/1
\end{verbatim} 
\end{quote}
 
\paragraph*{Update}
je požadavek, pro upravení konkrétního záznamu přes metodu PUT. 

\begin{quote}
\begin{verbatim}
PUT /observations/1
\end{verbatim} 
\end{quote}

\paragraph*{Delete}
je požadavek, který smaže konkrétní záznam pomocí DELETE metody.

\begin{quote}
\begin{verbatim}
DELETE /observations/1
\end{verbatim} 
\end{quote}

\section{Struktura aplikace}
V této sekci popíši základní strukturu aplikace. Struktura aplikace je vygenerovaná pomocí generátoru v Ruby on Rails. Proto nepopíši celou strukturu, ale pouze části aplikace, které jsou nejdůležitější pro její vývoj. Na obrázku \ref{tree:hospitace} je popsána struktura nejdůležitějších složek a popis jejich obsahu.

\begin{figure}[h]
	\dirtree{%
		.1 Hospitace/.
		.2 app/ \DTcomment{jádro MVC aplikace}.
		.3 assets/.
		.4 images/ \DTcomment{grafika  a obrázky}.
		.4 javascripts/ \DTcomment{JavaScriptové knihovny}.
		.4 stylesheets/ \DTcomment{kaskádové styly}.
		.3 controllers/ \DTcomment{controllers aplikace}.
		.3 helpers/ \DTcomment{pomocné metody pro šablony}.
		.3 inputs/ \DTcomment{vytvořené vstupní pole pro knihovnu SimpleForm}.
		.3 mailers/ \DTcomment{třídy které generují a odesílají emaily}.
		.3 models/ \DTcomment{modely aplikace}.
		.3 views/ \DTcomment{šablony aplikace}.		
		.2 lib/\DTcomment{knihovny a moduly pro aplikaci}.
		.3 email\_templates/ \DTcomment{modul pro generování emailů}.
		.3 tasks/ \DTcomment{rake scripty}.
		.3 kosapi/ \DTcomment{knihovna pro připojení ke KOSapi}.
		.3 will\_paginate/ \DTcomment{rozšíření pro knihovnu will\_paginate}.
		.2 public/ \DTcomment{obsahuje statické soubory přístupné z webu}.
		.2 config/ \DTcomment{konfigurační soubory a směrování}.		
		.2 db/ \DTcomment{schéma databáze a databázové migrace}. 
		.2 test/\DTcomment{testy, testovací data a nástroje pro testování aplikace}.
	}
	\caption{Struktura aplikace}
\label{tree:hospitace}
\end{figure}